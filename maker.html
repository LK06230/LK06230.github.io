<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë©”ì´ì»¤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:system-ui;background:#020617;color:#e5e7eb;padding:30px}
h1,h2{margin-top:40px}
input,textarea,select{
  width:100%;padding:10px;margin-top:6px;
  border-radius:6px;border:none;background:#0f172a;color:#e5e7eb
}
button{
  margin-top:10px;padding:8px 12px;
  border:none;border-radius:6px;font-weight:bold;cursor:pointer
}
.create{background:#22c55e;color:#022c22}
.select{background:#38bdf8;color:#022c22}
.quest{background:#0f172a;padding:16px;border-radius:10px;margin-top:16px}
small{opacity:.7}
</style>
</head>
<body>

<h1>ğŸ§‘â€ğŸ’¼ ë©”ì´ì»¤</h1>

<!-- 1ï¸âƒ£ í€˜ìŠ¤íŠ¸ ìƒì„± -->
<h2>â• í€˜ìŠ¤íŠ¸ ìƒì„±</h2>

<input id="title" placeholder="í€˜ìŠ¤íŠ¸ ì œëª©">
<textarea id="desc" placeholder="ìƒì„¸ ì„¤ëª…"></textarea>
<input id="reward" type="number" placeholder="ë³´ìƒ ê¸ˆì•¡">
<input id="deadline" type="date">
<select id="category">
  <option>ë””ìì¸</option>
  <option>ê¸€ì“°ê¸°</option>
  <option>ì¡°ì‚¬</option>
</select>

<button class="create" onclick="createQuest()">í€˜ìŠ¤íŠ¸ ë“±ë¡</button>

<!-- 2ï¸âƒ£ í€˜ìŠ¤íŠ¸ ê´€ë¦¬ -->
<h2>ğŸ“‹ ë‚´ê°€ ë§Œë“  í€˜ìŠ¤íŠ¸</h2>
<div id="list"></div>

<script>
const QUEST_KEY="quests";
const APPLY_KEY="applications";

let quests=JSON.parse(localStorage.getItem(QUEST_KEY))||[];
let apps=JSON.parse(localStorage.getItem(APPLY_KEY))||[];

function save(){
  localStorage.setItem(QUEST_KEY,JSON.stringify(quests));
  localStorage.setItem(APPLY_KEY,JSON.stringify(apps));
  render();
}

function createQuest(){
  quests.push({
    id:Date.now(),
    title:title.value,
    description:desc.value,
    reward:reward.value,
    deadline:deadline.value,
    category:category.value,
    status:"open"
  });
  save();
}

function selectSolver(qid,sid){
  const q=quests.find(q=>q.id===qid);
  q.status="in_progress";
  q.assignedSolverId=sid;

  function approveQuest(qid){
  const q=quests.find(q=>q.id===qid);
  q.status="completed";

  const solverId=q.assignedSolverId;
  const users=JSON.parse(localStorage.getItem("users"))||[];

  let solver=users.find(u=>u.id===solverId);
  if(!solver){
    solver={id:solverId,role:"solver",balance:0};
    users.push(solver);
  }

  solver.balance += Number(q.reward);
  localStorage.setItem("users",JSON.stringify(users));
  save();
}
  
  apps.forEach(a=>{
    if(a.questId===qid){
      a.status=a.solverId===sid?"accepted":"rejected";
    }
  });
  save();
}

function render(){
  list.innerHTML="";
  quests.forEach(q=>{
    const div=document.createElement("div");
    div.className="quest";

    const related=apps.filter(a=>a.questId===q.id && a.status==="applied");

    div.innerHTML=`
      <strong>${q.title}</strong><br>
      ìƒíƒœ: ${q.status}<br>
      <small>ì§€ì›ì: ${related.length}</small>
    `;

    related.forEach(a=>{
      const btn=document.createElement("button");
      btn.className="select";
      btn.textContent=`${a.solverId} ì„ íƒ`;
      btn.onclick=()=>selectSolver(q.id,a.solverId);
      div.appendChild(document.createElement("br"));
      div.appendChild(btn);
    });

    list.appendChild(div);
  });
}

render();
  if(q.status==="review"){
  const btn=document.createElement("button");
  btn.textContent="ìŠ¹ì¸ & ë³´ìƒ ì§€ê¸‰";
  btn.onclick=()=>approveQuest(q.id);
  div.appendChild(document.createElement("br"));
  div.appendChild(btn);
}
</script>
</body>
</html>
