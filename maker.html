<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Maker</title>
<style>
body{background:#020617;color:#e5e7eb;font-family:system-ui;padding:20px}
input,textarea{width:100%;margin:6px 0;padding:6px}
.quest{border:1px solid #334155;padding:10px;margin-top:10px}
button{margin-top:6px}
</style>
</head>
<body>

<h2>ğŸ§‘â€ğŸ’¼ ë©”ì´ì»¤</h2>

<input id="title" placeholder="í€˜ìŠ¤íŠ¸ ì œëª©">
<textarea id="desc" placeholder="ì„¤ëª…"></textarea>
<input id="reward" type="number" placeholder="ë³´ìƒ ê¸ˆì•¡">
<button onclick="createQuest()">í€˜ìŠ¤íŠ¸ ë“±ë¡</button>

<hr>
<div id="list"></div>

<script>
const user=JSON.parse(localStorage.getItem("currentUser"));
let quests=JSON.parse(localStorage.getItem("quests"))||[];

function save(){
  localStorage.setItem("quests",JSON.stringify(quests));
  render();
}

function createQuest(){
  quests.push({
    id:Date.now(),
    maker:user.id,
    title:title.value,
    desc:desc.value,
    reward:Number(reward.value),
    status:"open",
    applicants:[],
    assigned:null
  });
  save();
}

function selectSolver(qid,solver){
  const q=quests.find(q=>q.id===qid);
  q.assigned=solver;
  q.status="in_progress";
  save();
}

function approve(qid){
  const q=quests.find(q=>q.id===qid);
  q.status="completed";

  const users=JSON.parse(localStorage.getItem("users"))||[];
  const solver=users.find(u=>u.id===q.assigned);
  solver.balance+=q.reward;
  localStorage.setItem("users",JSON.stringify(users));

  save();
}

function render(){
  list.innerHTML="";
  quests.filter(q=>q.maker===user.id).forEach(q=>{
    const d=document.createElement("div");
    d.className="quest";
    d.innerHTML=`
      <b>${q.title}</b><br>
      ìƒíƒœ: ${q.status}<br>
      ë³´ìƒ: ${q.reward}
    `;

    if(q.status==="open"){
      q.applicants.forEach(s=>{
        const b=document.createElement("button");
        b.textContent=s+" ì„ íƒ";
        b.onclick=()=>selectSolver(q.id,s);
        d.appendChild(document.createElement("br"));
        d.appendChild(b);
      });
    }

    if(q.status==="review"){
      const b=document.createElement("button");
      b.textContent="ìŠ¹ì¸ & ë³´ìƒ ì§€ê¸‰";
      b.onclick=()=>approve(q.id);
      d.appendChild(document.createElement("br"));
      d.appendChild(b);
    }

    list.appendChild(d);
  });
}
render();
</script>

</body>
</html>
